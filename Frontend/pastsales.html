<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kanaklata Agency · Past Sales</title>
  <style>
    :root{
      --panel: rgba(255,255,255,.10);
      --card:  rgba(255,255,255,.12);
      --text:#e6edf7; --muted:#a7b3c6;
      --accent:#6ea8ff; --accent-2:#3f7ee6; --success:#10b981; --warning:#f59e0b;
      --ring:#7aa2ff; --radius:16px;
      --shadow:0 22px 54px rgba(0,0,0,.32);
      --border:1px solid rgba(255,255,255,.16);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow-x:hidden}
    body{
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% 15%, rgba(20,30,48,.45) 0%, transparent 55%),
        radial-gradient(1000px 650px at 90% 10%, rgba(36,59,85,.40) 0%, transparent 60%),
        linear-gradient(135deg, #141E30 0%, #243B55 100%);
      background-attachment:fixed; padding:22px;
    } /* Premium palette to match the suite. [web:438] */

    /* Ambient blobs */
    .fx{position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden}
    .blob{position:absolute; width:40vmax; height:40vmax; border-radius:50%; filter:blur(60px); opacity:.18; mix-blend-mode:screen; background: radial-gradient(closest-side, rgba(52,78,123,.85), transparent 70%); animation: blobFloat 26s ease-in-out infinite alternate}
    .blob.b1{left:-12%; top:-10%}
    .blob.b2{left:58%; top:0%; background:radial-gradient(closest-side, rgba(36,99,160,.85), transparent 70%); animation-delay:-8s}
    @keyframes blobFloat{0%{transform:translate3d(0,0,0) scale(1)}50%{transform:translate3d(2%,-3%,0) scale(1.03)}100%{transform:translate3d(-2%,2%,0) scale(1.05)}} /* Subtle motion for depth. [web:382] */

    .wrap{position:relative; z-index:1; max-width:1200px; margin:0 auto; display:grid; gap:22px}

    /* Header with shimmer */
    .header{
      background:var(--card); border:var(--border); border-radius:20px; padding:18px 22px;
      box-shadow:var(--shadow); display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;
      backdrop-filter: blur(14px); position:relative; overflow:hidden;
    }
    .header h1{font-size:20px; font-weight:900}
    .header::after{content:""; position:absolute; inset:0; transform:translateX(-100%); background:linear-gradient(120deg, transparent, rgba(255,255,255,.16), transparent); mix-blend-mode:soft-light; animation: shimmer 3.2s infinite}
    @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .range, .mode{
      background:rgba(255,255,255,.10); border:2px solid rgba(110,168,255,.25); border-radius:14px; padding:8px 12px; color:var(--text); backdrop-filter: blur(8px);
    }
    .range:focus-within, .mode:focus-within{border-color:var(--accent); box-shadow:0 0 0 4px rgba(110,168,255,.18)} /* A11y focus ring. [web:398] */
    .range input[type="date"], .mode select{border:none; outline:none; background:transparent; font-weight:700; color:var(--text)}

    .grid{display:grid; grid-template-columns:1.2fr 1fr; gap:22px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    .panel{background:var(--panel); border:var(--border); border-radius:20px; padding:18px; box-shadow:var(--shadow); backdrop-filter:blur(14px); transition: transform .2s ease, box-shadow .2s ease}
    .panel:hover{transform:translateY(-2px); box-shadow:0 26px 58px rgba(0,0,0,.36)}
    .panel header{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .panel h2{font-size:16px; font-weight:900}
    .hint{font-size:12px; color:var(--muted)}

    /* KPIs */
    .totals{display:grid; grid-template-columns: repeat(4, 1fr); gap:12px}
    @media (max-width:840px){ .totals{grid-template-columns:1fr 1fr} }
    @media (max-width:520px){ .totals{grid-template-columns:1fr} }
    .kpi{background:var(--card); border:var(--border); border-radius:16px; padding:14px; display:flex; align-items:center; justify-content:space-between; gap:10px; backdrop-filter: blur(10px); box-shadow:0 12px 28px rgba(0,0,0,.24)}
    .kpi .name{font-size:12px; color:#c4d4f3; font-weight:800; text-transform:uppercase}
    .kpi .val{font-size:22px; font-weight:900}
    .ok{color:#34d399} .warn{color:#fbbf24}

    /* Table */
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:14px; box-shadow:0 8px 18px rgba(0,0,0,.28)}
    thead th{font-size:12px; text-align:left; color:#c4d4f3; text-transform:uppercase; letter-spacing:.5px; padding:12px; background:rgba(255,255,255,.06)}
    tbody td{padding:12px; border-top:1px solid rgba(229,231,235,.18); font-weight:700; color:#e9f0ff}
    tbody tr:hover{background:rgba(110,168,255,.10)} /* Gentle row hover. [web:464] */

    .filters{display:flex; gap:10px; flex-wrap:wrap}
    .btn{border:none; padding:12px 16px; border-radius:12px; font-weight:900; letter-spacing:.2px; cursor:pointer; background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#061020; box-shadow:0 12px 28px rgba(56,189,248,.28); transition:.2s}
    .btn:hover{transform:translateY(-2px)}
    .btn.secondary{background:rgba(110,168,255,.14); color:#d6e3ff; border:1px solid rgba(110,168,255,.35); box-shadow:none}
  </style>
</head>
<body>
  <!-- ambient blobs -->
  <div class="fx">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
  </div>

  <div class="wrap">
    <section class="header">
      <h1>Past Sales</h1>
      <div class="row">
        <div class="range">
          <strong>From:</strong>
          <input id="fromDate" type="date" aria-label="From date">
          <strong style="margin-left:6px">To:</strong>
          <input id="toDate" type="date" aria-label="To date">
        </div>
        <div class="mode">
          <label for="viewMode">View</label>
          <select id="viewMode">
            <option value="daily" selected>Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="filters">
          <button class="btn" id="applyBtn" type="button">Apply</button>
          <button class="btn secondary" id="clearBtn" type="button">Clear</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="panel" aria-labelledby="sumTitle">
        <header>
          <h2 id="sumTitle">Summary</h2>
          <div class="hint">Calculated from selected period</div>
        </header>

        <div class="totals">
          <div class="kpi"><span class="name">Total Sales</span><span class="val ok" id="kpiTotalSales">0</span></div>
          <div class="kpi"><span class="name">Total Returns</span><span class="val warn" id="kpiTotalReturns">0</span></div>
          <div class="kpi"><span class="name">Net Sales</span><span class="val" id="kpiNetSales">0</span></div>
          <div class="kpi"><span class="name">Days Count</span><span class="val" id="kpiDays">0</span></div>
        </div>

        <div class="section" style="margin-top:14px">
          <header class="row" style="justify-content:space-between">
            <strong>Breakdown</strong>
            <small class="hint">Sorted by date</small>
          </header>

          <table id="salesTable" style="margin-top:10px">
            <thead><tr><th>Date</th><th>Sales</th><th>Returns</th><th>Net</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="panel" aria-labelledby="notesTitle">
        <header>
          <h2 id="notesTitle">Notes</h2>
          <div class="hint">Context, anomalies, or adjustments</div>
        </header>
        <div class="section" id="notesBox" style="min-height:140px; color:#cdd8f2">
          No notes for this range.
        </div>
      </section>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:8080/api';
    const PAST_ENDPOINT = `${API_BASE}/pastsales`; // expected: ?from=YYYY-MM-DD&to=YYYY-MM-DD&view=daily|weekly|monthly
    const byId = id => document.getElementById(id);
    const INR = n => '₹' + Number(n || 0).toLocaleString('en-IN');

    // Defaults: last 7 days
    const today = new Date();
    const toISO = d => d.toISOString().slice(0,10);
    const addDays = (d, n)=> { const x=new Date(d); x.setDate(x.getDate()+n); return x; };

    byId('toDate').value = toISO(today);
    byId('fromDate').value = toISO(addDays(today, -6));

    function setText(id, v){ byId(id).textContent = v; }

    function renderRows(rows){
      const tb = document.querySelector('#salesTable tbody');
      tb.innerHTML = rows.map(r=>{
        const sales = Number(r.sales||0), ret = Number(r.returns||0), net = sales - ret;
        return `<tr>
          <td>${r.date || r.label || ''}</td>
          <td><strong>${sales.toFixed(2)}</strong></td>
          <td>${ret.toFixed(2)}</td>
          <td>${net.toFixed(2)}</td>
        </tr>`;
      }).join('');
    }

    function summarize(rows){
      const totals = rows.reduce((a,r)=>({
        sales: a.sales + Number(r.sales||0),
        returns: a.returns + Number(r.returns||0),
        days: a.days + 1
      }), {sales:0, returns:0, days:0});
      setText('kpiTotalSales', totals.sales.toFixed(2));
      setText('kpiTotalReturns', totals.returns.toFixed(2));
      setText('kpiNetSales', (totals.sales - totals.returns).toFixed(2));
      setText('kpiDays', String(totals.days));
    }

    async function loadPast(){
      const from = byId('fromDate').value;
      const to   = byId('toDate').value;
      const view = byId('viewMode').value;
      const url = `${PAST_ENDPOINT}?from=${from}&to=${to}&view=${view}`;
      try{
        const r = await fetch(url, { credentials:'include' });
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data = await r.json();
        const rows = Array.isArray(data?.rows) ? data.rows : [];
        renderRows(rows);
        summarize(rows);
        byId('notesBox').textContent = data?.notes || 'No notes for this range.';
      }catch(e){
        console.error(e);
        renderRows([]); summarize([]); byId('notesBox').textContent = 'Failed to load. Check server/CORS.';
      }
    }

    byId('applyBtn').addEventListener('click', loadPast);
    byId('clearBtn').addEventListener('click', ()=>{
      byId('toDate').value = toISO(today);
      byId('fromDate').value = toISO(addDays(today, -6));
      byId('viewMode').value = 'daily';
      loadPast();
    });

    // Initial load
    loadPast();
  </script>
</body>
</html>
