<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orders ¬∑ Kanaklata Agency</title>
  <link rel="stylesheet" href="./admin.css" />
  <style>
    body, .main {
      background: radial-gradient(1350px circle at 25% 20%, #273043 0%, #1B202A 90%) !important;
      color: #e5e7eb;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .sidebar {
      background: rgba(22, 26, 37, 0.94);
      box-shadow: 0 0 24px 0 rgba(0,0,0,0.25);
    }
    .orders-panel, .orders-hero, .stats-grid .stat-card, .action-bar {
      background: rgba(33,37,50,0.86) !important;
      color: #e5e7eb !important;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.20);
    }
    .orders-table th, .orders-table td {
      background: transparent !important;
      color: #e5e7eb !important;
      border-bottom: 1px solid rgba(153,153,160,0.13);
    }
    .orders-table tbody tr:hover {
      background: rgba(59,130,246,0.08) !important;
    }
    input, select, textarea {
      background: rgba(44,48,64,0.88);
      border: 1px solid #3b4261;
      color: #e5e7eb;
      border-radius: 7px;
      margin-bottom: 7px;
      padding: 9px 12px;
    }
    input:focus, select:focus, textarea:focus {
      outline: 2px solid #3b82f6;
    }
    .stat-icon {
      width: 76px;
      height: 76px;
      margin: 0 auto 1rem;
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.7rem;
      background: inherit;
      transition: transform 0.22s cubic-bezier(.22,1,.36,1), box-shadow 0.22s;
      box-shadow: 0 0 0 rgba(59,130,246,0);
    }
    /* Stat card hover effect */
    .stat-card:hover .stat-icon, .stat-card:focus .stat-icon {
      transform: scale(1.13) rotate(7deg);
      box-shadow: 0 0 0 6px #7fcff944, 0 10px 22px #3b82f6de;
      filter: brightness(1.15) drop-shadow(0 0 4px #3b82f6b6);
    }
    /* Action Button Icons */
    .btn-action .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      margin-right: 0.67em;
      transition: transform 0.22s cubic-bezier(.22,1,.36,1), box-shadow 0.22s;
    }
    .btn-action:hover .icon, .btn-action:focus .icon {
      transform: scale(1.18) rotate(10deg);
      box-shadow: 0 6px 21px rgba(59,130,246,0.23), 0 2px 2px rgba(130,186,255,0.06);
      filter: brightness(1.25) drop-shadow(0 0 3px #3b82f673);
    }
    .btn-primary {
      background: linear-gradient(90deg, #2363eb 0%, #4a7ce8 100%) !important;
      color: #FFF !important;
      border: none !important;
      box-shadow: 0 2px 8px rgba(59,130,246,0.13);
    }
    .btn-secondary {
      background: rgba(255,255,255,.14);
      color: #e5e7eb !important;
      border: 1px solid rgba(255,255,255,.12);
    }
    .btn-success {
      background: linear-gradient(90deg, #17c29e 0%, #36a6d8 100%) !important;
      color: #fff !important;
      border: none !important;
    }
    .modal-overlay {
      position: fixed; top:0; left:0; width:100vw; height:100vh;
      background: rgba(16,22,32,0.42); z-index:99999;
      display: flex; align-items: center; justify-content: center;
    }
    .modal-content {
      background: rgba(33,37,50,0.94);
      padding: 2.1rem 2rem 1.6rem;
      border-radius: 17px;
      min-width: 320px; max-width: 95vw;
      box-shadow: 0 10px 38px rgba(0,0,0,.30);
      color: #e5e7eb;
      font-size: 1rem;
    }
    /* Search icon in input */
    .search-box {
      position: relative;
    }
    .search-box input {
      padding-left: 2.5em !important;
    }
    .search-box .icon-search {
      position: absolute;
      left: 14px; top: 50%;
      transform: translateY(-50%);
      font-size: 1.5em;
      color: #2363eb;
      background: none;
      text-shadow: 0 2px 8px #3b82f689;
      filter: drop-shadow(0 0 2px #7fcff9);
      pointer-events: none;
    }
    .empty-state .empty-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: .7;
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">Kanaklata Agency</div>
      <nav class="nav">
        <a href="adminindex.html">Dashboard</a>
        <a href="workers.html">Workers</a>
        <a class="active" href="orders.html">Orders</a>
        <a href="payments.html">Payments</a>
        <a href="inventory.html">Inventory</a>
        <a href="reports.html">Reports</a>
        <a href="profiles.html">Profiles</a>
        <a href="daily-sales.html">Daily Sales</a>
      </nav>
      <div class="foot">¬© <span id="y"></span> Kanaklata Agency</div>
    </aside>

    <header class="header">
      <h3>Orders Management</h3>
      <div class="user"><span class="badge">Admin</span></div>
    </header>
    <main class="main">
      <div class="orders-hero">
        <h1>üìã Orders Hub</h1>
        <p class="subtitle">Manage customer orders from creation to delivery</p>
      </div>

      <div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2.5rem; position: relative; z-index: 2;">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg,#3b82f6, #1d4ed8);"><span>üìù</span></div>
          <div class="stat-number" id="order-count">0</div>
          <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg,#f59e0b,#d97706);"><span>‚è≥</span></div>
          <div class="stat-number" id="pending-count">0</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg,#36a6d8, #17c29e);"><span>‚ú®</span></div>
          <div class="stat-number" id="new-count">0</div>
          <div class="stat-label">New Orders</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg,#ef4444,#dc2626);"><span>üí∞</span></div>
          <div class="stat-number" id="value-count">0</div>
          <div class="stat-label">Total Value (‚Çπ)</div>
        </div>
      </div>

      <div class="action-bar" style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
        <div class="search-box" style="flex:1; min-width:250px;">
          <span class="icon-search">üîç</span>
          <input type="text" id="searchOrders" placeholder="Search orders by ID, customer, or product..." style="width:100%;" />
        </div>
        <div class="action-buttons" style="display: flex; gap: 1rem; align-items: center;">
          <button class="btn-action btn-primary" id="addOrderBtn" onclick="createOrder()">
            <span class="icon">‚ûï</span> New Order
          </button>
          <button class="btn-action btn-secondary" onclick="exportOrders()">
            <span class="icon">üì§</span> Export
          </button>
          <button class="btn-action btn-success" onclick="refreshOrders()">
            <span class="icon">üîÑ</span> Refresh
          </button>
        </div>
      </div>

      <div class="orders-panel">
        <div class="panel-header">
          <h3>All Orders</h3>
          <div class="filters">
            <select class="filter-select" id="statusFilter" onchange="filterOrders()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <select class="filter-select" id="dateFilter" onchange="filterOrders()">
              <option value="">All Time</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
            </select>
          </div>
        </div>
        <table class="orders-table" id="ordersTable">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Products</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody">
            <!-- Orders will populate here -->
          </tbody>
        </table>
        <div class="empty-state" id="emptyState" style="display: none;">
          <div class="empty-icon">üì¶</div>
          <h3>No Orders Found</h3>
          <p>No orders match your current filters. Try adjusting your search criteria.</p>
        </div>
      </div>
    </main>
  </div>
<script>
let ordersData = [];
let filteredOrders = [];

document.getElementById("y").textContent = new Date().getFullYear();

document.addEventListener('DOMContentLoaded', function() {
  fetch('orders.json')
    .then(r => r.json())
    .then(data => {
      ordersData = data;
      filteredOrders = [...ordersData];
      renderOrders();
      animateCounters();
      setupSearchFilter();
    });
});

function animateCounters() {
  document.getElementById('order-count').textContent = ordersData.length;
  document.getElementById('pending-count').textContent = ordersData.filter(o=>o.status==="pending").length;
  document.getElementById('new-count').textContent = ordersData.filter(o=>o.status==="processing"||o.status==="shipped").length;
  document.getElementById('value-count').textContent = ordersData.reduce((s,o)=>s+parseFloat(o.total),0);
}

function renderOrders() {
  const tbody = document.getElementById('ordersTableBody');
  const emptyState = document.getElementById('emptyState');
  if (filteredOrders.length === 0) {
    tbody.innerHTML = '';
    emptyState.style.display = 'block';
    return;
  }
  emptyState.style.display = 'none';
  tbody.innerHTML = filteredOrders.map(order => `
    <tr>
      <td><strong>${order.id}</strong></td>
      <td>
        <div>${order.customer}</div>
        <small style="color: #aaa;">${order.phone}</small>
      </td>
      <td>${order.products}</td>
      <td><strong>‚Çπ${order.total}</strong></td>
      <td>
        <span class="status-badge status-${order.status}">${order.status}</span>
      </td>
      <td>${new Date(order.date).toLocaleDateString()}</td>
      <td>
        <div class="table-actions">
          <button class="btn-small btn-view" onclick="openModal('view', '${order.id}')">üëÅÔ∏è View</button>
          <button class="btn-small btn-edit" onclick="openModal('edit', '${order.id}')">‚úèÔ∏è Edit</button>
          <button class="btn-small btn-delete" onclick="deleteOrder('${order.id}')">üóëÔ∏è Delete</button>
        </div>
      </td>
    </tr>
  `).join('');
}

function setupSearchFilter() {
  const searchInput = document.getElementById('searchOrders');
  searchInput.addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    filteredOrders = ordersData.filter(order =>
      order.id.toLowerCase().includes(searchTerm) ||
      order.customer.toLowerCase().includes(searchTerm) ||
      order.products.toLowerCase().includes(searchTerm)
    );
    applyStatusFilter();
    renderOrders();
  });
}

// Filtering helpers
function filterOrders() {
  const searchTerm = document.getElementById('searchOrders').value.toLowerCase();
  filteredOrders = ordersData.filter(order =>
    order.id.toLowerCase().includes(searchTerm) ||
    order.customer.toLowerCase().includes(searchTerm) ||
    order.products.toLowerCase().includes(searchTerm)
  );
  applyStatusFilter();
  renderOrders();
}
function applyStatusFilter() {
  const statusFilter = document.getElementById('statusFilter').value;
  const dateFilter = document.getElementById('dateFilter').value;
  if (statusFilter) {
    filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
  }
  if (dateFilter) {
    const today = new Date();
    filteredOrders = filteredOrders.filter(order => {
      const oDate = new Date(order.date);
      switch (dateFilter) {
        case 'today':
          return oDate.toDateString() === today.toDateString();
        case 'week':
          const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
          return oDate >= weekAgo;
        case 'month':
          return oDate.getMonth() === today.getMonth() && oDate.getFullYear() === today.getFullYear();
        default:
          return true;
      }
    });
  }
}

// Modal utilities
function showModal(content) {
  let modal = document.getElementById('modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.id = 'modal';
    modal.innerHTML = `<div class='modal-content'>${content}</div>`;
    document.body.appendChild(modal);
  } else {
    modal.innerHTML = `<div class='modal-content'>${content}</div>`;
    modal.style.display = 'flex';
  }
}
function closeModal() {
  const modal = document.getElementById('modal');
  if (modal) modal.style.display = 'none';
}
function openModal(type, orderId) {
  const order = ordersData.find(o => o.id === orderId);
  let modalContent = '';
  if (type === 'view') {
    modalContent = `
      <h3 style="margin-bottom:12px;">Order Details (ID: ${order.id})</h3>
      <p><b>Customer:</b> ${order.customer} (${order.phone})<br>
      <b>Products:</b> ${order.products}<br>
      <b>Total:</b> ‚Çπ${order.total}<br>
      <b>Status:</b> ${order.status}<br>
      <b>Date:</b> ${new Date(order.date).toLocaleDateString()}</p>
      <button onclick="closeModal()" class="btn-primary">Close</button>
    `;
  } else if (type === 'edit') {
    modalContent = `
      <h3>Edit Order: ${order.id}</h3>
      <form id="editOrderForm">
        <input id="editCustomer" value="${order.customer}" required><br>
        <input id="editPhone" value="${order.phone}" required><br>
        <textarea id="editProducts" required>${order.products}</textarea><br>
        <input id="editTotal" value="${order.total}" type="number" required><br>
        <select id="editStatus" required>
          <option ${order.status==='pending'?'selected':''}>pending</option>
          <option ${order.status==='processing'?'selected':''}>processing</option>
          <option ${order.status==='shipped'?'selected':''}>shipped</option>
          <option ${order.status==='delivered'?'selected':''}>delivered</option>
          <option ${order.status==='cancelled'?'selected':''}>cancelled</option>
        </select><br>
        <input id="editDate" value="${order.date}" type="date" required><br>
        <button type="submit" class="btn-primary">Save</button>
        <button type="button" onclick="closeModal()" class="btn-secondary" style="margin-left:10px;">Cancel</button>
      </form>
    `;
  }
  showModal(modalContent);
  if (type === 'edit') {
    document.getElementById('editOrderForm').onsubmit = function(e) {
      e.preventDefault();
      saveEdit(order.id);
    }
  }
}
function saveEdit(orderId) {
  const idx = ordersData.findIndex(o => o.id === orderId);
  if (idx > -1) {
    const prevStatus = ordersData[idx].status;
    ordersData[idx].customer = document.getElementById('editCustomer').value;
    ordersData[idx].phone = document.getElementById('editPhone').value;
    ordersData[idx].products = document.getElementById('editProducts').value;
    ordersData[idx].total = parseFloat(document.getElementById('editTotal').value);
    ordersData[idx].status = document.getElementById('editStatus').value;
    ordersData[idx].date = document.getElementById('editDate').value;
    filteredOrders = [...ordersData];
    renderOrders();
    animateCounters();
    closeModal();
    alert('‚úÖ Changes saved!');
    // WhatsApp send if delivered
    if (prevStatus !== 'delivered' && ordersData[idx].status === 'delivered') {
      sendWhatsappReceipt(ordersData[idx]);
    }
  }
}
function sendWhatsappReceipt(order) {
  // Construct order summary/receipt text
  const message = `Order Delivered!\n`
    + `Order ID: ${order.id}\n`
    + `Customer: ${order.customer}\n`
    + `Products: ${order.products}\n`
    + `Total: ‚Çπ${order.total}\n`
    + `Date: ${new Date(order.date).toLocaleDateString()}\n`
    + "RECEIPT / INVOICE: [Download link or see admin panel]";
  // WhatsApp API link (opens chat prefilled to the recipient)
  const whatsappNumber = "918328988365";
  const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
  window.open(url, '_blank');
}

// New Order modal
function createOrder() {
  const today = (new Date()).toISOString().split('T')[0];
  const modalContent = `
    <h3 style="margin-bottom:1.2rem;">New Order</h3>
    <form id="newOrderForm">
      <input required placeholder="Customer name" id="newCustomer" style="width:90%;margin-bottom:12px;"><br>
      <input required placeholder="Phone" id="newPhone" style="width:90%;margin-bottom:12px;"><br>
      <textarea required placeholder="Products" id="newProducts" style="width:90%;margin-bottom:12px;"></textarea><br>
      <input required type="number" placeholder="Total Amount" id="newTotal" style="width:90%;margin-bottom:12px;"><br>
      <select id="newStatus" style="width:92%;margin-bottom:12px;">
        <option value="pending">pending</option>
        <option value="processing">processing</option>
        <option value="shipped">shipped</option>
        <option value="delivered">delivered</option>
        <option value="cancelled">cancelled</option>
      </select><br>
      <input required type="date" id="newDate" style="width:90%;margin-bottom:12px;" value="${today}"><br>
      <button type="submit" class="btn-primary">Save Order</button>
      <button type="button" onclick="closeModal()" class="btn-secondary" style="margin-left:10px;">Cancel</button>
    </form>
  `;
  showModal(modalContent);
  document.getElementById('newOrderForm').onsubmit = function(e) {
    e.preventDefault();
    const newOrder = {
      id: "ORD-" + String(ordersData.length + 1).padStart(3, '0'),
      customer: document.getElementById('newCustomer').value,
      phone: document.getElementById('newPhone').value,
      products: document.getElementById('newProducts').value,
      total: parseFloat(document.getElementById('newTotal').value),
      status: document.getElementById('newStatus').value,
      date: document.getElementById('newDate').value
    };
    ordersData.push(newOrder);
    filteredOrders = [...ordersData];
    renderOrders();
    animateCounters();
    closeModal();
    alert('‚úÖ New order added!');
  };
}
// Delete & Export actions
function deleteOrder(orderId) {
  if (confirm(`üóëÔ∏è Delete Order ${orderId}?\n\nAre you sure you want to delete this order?`)) {
    const index = ordersData.findIndex(o => o.id === orderId);
    if (index > -1) {
      ordersData.splice(index, 1);
      filteredOrders = [...ordersData];
      renderOrders();
      animateCounters();
      alert('‚úÖ Order deleted successfully!');
    }
  }
}
function exportOrders() {
  const csvContent = [
    ['Order ID', 'Customer', 'Products', 'Total', 'Status', 'Date'],
    ...filteredOrders.map(order => [
      order.id,
      order.customer,
      order.products,
      order.total,
      order.status,
      order.date
    ])
  ].map(row => row.join(',')).join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `orders_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  window.URL.revokeObjectURL(url);
  alert('üì§ Export complete! CSV file downloaded.');
}
function refreshOrders() {
  const refreshButton = event.target;
  refreshButton.innerHTML = 'üîÑ Refreshing...';
  refreshButton.disabled = true;
  setTimeout(() => {
    filteredOrders = [...ordersData];
    renderOrders();
    animateCounters();
    refreshButton.innerHTML = 'üîÑ Refresh';
    refreshButton.disabled = false;
    alert('‚úÖ Orders refreshed successfully!');
  }, 800);
}
</script>
</body>
</html>
